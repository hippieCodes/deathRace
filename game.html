<!DOCTYPE HTML>
<html>
	<head>
		<style>
			body {
				margin: 0px;
				padding: 0px;
			}
		</style>
	</head>
	<body>
		<div style="background-image:url('image/road.jpg');height: 700px; width: 300px;">
		<canvas id="myCanvas" width="300" height="700" style="border:0px solid red;"></canvas>
		</div>
		<script>
			var thirdObstacleInView = false;
			window.requestAnimFrame = (function(callback) {
				return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
				function(callback) {
					window.setTimeout(callback, 1000 / 60);
				};
			})();

			function drawTank(tank, context) {
				context.drawImage(tank.tankSource, tank.x, tank.y);
				// context.beginPath();
				// context.rect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
				// context.fillStyle = obstacle.color;
				// context.fill();
				//context.lineWidth = obstacle.borderWidth;
				//context.strokeStyle = 'black';
				//context.stroke();
			}

			function animate(obstacle, canvas, context, startTime) {
				// update
				var time = (new Date()).getTime() - startTime;

				var linearSpeed = 100;
				// pixels / second
				var newY = linearSpeed * time / 1000;

				context.clearRect(obstacle.x, obstacle.y - 2, obstacle.width + 1, obstacle.height);
				if (newY < canvas.height - obstacle.height / 2) {
					if (newY >= 200 && !thirdObstacleInView) {
						drawTank(middleObstacle, context);
						var startTime1 = (new Date()).getTime();
						animate(middleObstacle, canvas, context, startTime1);
						thirdObstacleInView = true;
					}
					obstacle.y = newY;
				}
				else {
					removeObject(obstacle);
				}

				// clear

				drawTank(obstacle, context);

				// request new frame
				requestAnimFrame(function() {
					animate(obstacle, canvas, context, startTime);
				});
			}

			var canvas = document.getElementById('myCanvas');
			var context = canvas.getContext('2d');

			var tankImage = new Image();
			tankImage.src = 'image/tank.png';
var removeObject = function(maal, context) {
	context.save();
				context.clearRect(maal.x, maal.y, maal.width, maal.height);
				context.restore();
}

			var leftObstacle = {
				x : 30,
				y : 0,
				width : 41,
				height : 100,
				tankSource: tankImage
			};
			var rightObstacle = {
				x : 230,
				y : 0,
				width : 41,
				height : 100,
				tankSource: tankImage
			};
			var middleObstacle = {
				x : 130,
				y : 0,
				width : 41,
				height : 100,
				tankSource: tankImage
			};


			var bombImage = new Image();
			bombImage.src = 'image/truck_small.png';
			var bomb = {
				x : 135,
				y : 600,
				width : 33,
				height : 100,
				bombSource:bombImage
			};
			bombImage.onload = function() {
				drawBomb(bomb);
			}
			var drawBomb = function (bomb) {
				context.drawImage(bomb.bombSource, bomb.x, bomb.y);
			}
			window.addEventListener("keydown", function(e){ 
				console.log(e.keyCode);
				if (e.keyCode===37)
				{
					moveBombLeft();
				}
				else if(e.keyCode===39)
				{
					moveBombRight();
				}
				
				}, true);

			drawTank(rightObstacle, context);
			drawTank(leftObstacle, context);
			
			var moveBombLeft = function() {
				if (bomb.x === 35) return;
				removeObject(bomb, context);
				bomb.x = bomb.x - 100;
				drawBomb(bomb);
				//drawTank(bomb, context);
			};
			var moveBombRight = function() {
				if (bomb.x === 235) return;
				removeObject(bomb, context);
				bomb.x = bomb.x + 100;
				drawBomb(bomb);
			};
			// wait one second before starting animation
			var timeId = setTimeout(function() {
				var startTime = (new Date()).getTime();
				animate(leftObstacle, canvas, context, startTime);
				animate(rightObstacle, canvas, context, startTime);

			}, 1000);
		</script>
	</body>
</html>
